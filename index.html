<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Uploader</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .form-group { margin-bottom: 12px; }
    label { display: block; margin-bottom: 4px; }
    input, textarea, button { width: 100%; padding: 8px; }
    .preview img { max-width: 120px; margin-right: 8px; margin-top: 8px; }
  </style>
</head>
<body>
  <h2>Upload Product</h2>
  <form id="uploadForm">
    <div class="form-group">
      <label>Product Title:</label>
      <input type="text" id="title" required>
    </div>
    <div class="form-group">
      <label>Upload Images (3-4):</label>
      <input type="file" id="images" accept="image/*" multiple required>
      <div class="preview" id="preview"></div>
    </div>
    <div class="form-group">
      <label>Price:</label>
      <input type="number" id="price">
    </div>
    <div class="form-group">
      <label>Description:</label>
      <textarea id="description"></textarea>
    </div>
    <div class="form-group">
      <label>Your Name:</label>
      <input type="text" id="name">
    </div>
    <div class="form-group">
      <label>Phone:</label>
      <input type="text" id="phone">
    </div>
    <button type="submit">Submit</button>
  </form>

  <script>
    // Resize + compress image
    function compressImage(file, maxWidth = 800, quality = 0.7) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.createElement("canvas");
            const scale = maxWidth / img.width;
            const width = img.width > maxWidth ? maxWidth : img.width;
            const height = img.width > maxWidth ? img.height * scale : img.height;
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, width, height);
            resolve(canvas.toDataURL("image/jpeg", quality)); // compressed Base64
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
    }

    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const files = document.getElementById("images").files;
      const images = [];
      for (let file of files) {
        const compressed = await compressImage(file);
        images.push(compressed);
      }

      const data = {
        title: document.getElementById("title").value,
        price: document.getElementById("price").value,
        description: document.getElementById("description").value,
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        images: images,
        createdAt: new Date().toISOString()
      };

      // Send to Vercel API
      const res = await fetch("/api/upload", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const result = await res.json();
      alert(result.message);
    });
  </script>
</body>
</html>

